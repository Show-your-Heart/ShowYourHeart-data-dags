<!DOCTYPE html>
<html lang="es">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="initial-scale=1, shrink-to-fit=no, width=device-width" name="viewport">
    <title>Infografía Balance social</title>

    <!-- CSS -->
    <link href="../../static/css/styles_autonomas.css" rel="stylesheet" />

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.1/html2canvas.min.js"></script>


  </head>

  <body {% block bodyattrs %}{% endblock%}>

<header>
    <div class="corazon">
        <div class="titulo">
            {{Nombre}}<br>
            <em>{{TXT003}}</em> <!-- Enseña el corazón -->
        </div>
        <div class="logo-entidad" style="background-image: url({{Logo}})"></div>
    </div>

    <div class="mes titulo"> <!-- Balance/Auditoría social de la Economía Social y Solidaria [AÑO] -->
        {% if auditoria_balance.lower() == "bal" %}
            {% if TXT001 is string %}
                {{ ' '.join(TXT001.split(' ')[0:2]) }} <em>{{ ' '.join(TXT001.split(' ')[2:]) }}</em> {{ YEAR }}
            {% endif %}
        {% else %}
            {% if TXT002 is string %}
                {{ ' '.join(TXT002.split(' ')[0:2]) }} <em>{{ ' '.join(TXT002.split(' ')[2:]) }}</em> {{ YEAR }}
            {% endif %}
        {% endif %}
    </div>

    <div class="personas-porcent">
        <p><strong class="cifra cifra3">{% if ind1agrupadod != "nan" %}{{ind1agrupadod}}%{% else %}*{% endif%}</strong> {{TXT005}} </p> <!-- Mujeres -->
        <p><strong class="cifra cifra3">{% if ind1agrupadoh != "nan" %}{{ind1agrupadoh}}%{% else %}*{% endif%}</strong> {{TXT006}} </p> <!-- Hombres -->
        <p><strong class="cifra cifra3">{% if ind1agrupadoa != "nan" %}{{ind1agrupadoa}}%{% else %}*{% endif%}</strong> {{TXT007}} </p> <!-- Identidades no binarias -->
    </div>

    <div class="personas-numero">
        <div>
            <p class="label label1">{{TXT008}}</p> <!-- Trabajadoras -->
            <strong class="cifra cifra3">{{ind118}}</strong>

        </div>
    </div>

    <div class="personas text-center">
        <span class="cifra cifra2">{{ind1agrupado}}</span>
        <span class="label label3">{{TXT004}}</span> <!-- Personas de la organización-->

    </div>

    <div class="columnas">
        <div class="ingresos">
            <span class="label label2">{{TXT014}}</span> <!-- Ingresos -->
            <span class="cifra cifra4">{{q1203 | subrender}}€</span>
        </div>

        <div class="gastos">
            <span class="label label2">{{TXT015}}</span> <!-- Gastos -->
            <span class="cifra cifra4">{{q1201 | subrender}}€</span>
        </div>

    </div>

</header>

<div class="columna1">
    <section id="equidad">
        <img class="icono" src="../../static/img/equidad.png">
        <h2 class="titulo">{{TXT016}}</h2> <!-- Equidad -->
        <ul class="checklist">
            <li>{{TXT072}}</li> <!-- Al trabajar con otras autónomas: -->
            <li>{{TXT064}} <!-- Pensamos juntas el proyecto -->
                <span class="check">{% if q3406b == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
            <li>{{TXT063}} <!-- Elaboramos presupuesto juntas -->
                <span class="check">{% if q3406a == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
            <li>{{TXT065}} <!-- Compartimos pérdidas -->
                <span class="check">{% if q3406d == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
            <li>{{TXT062}} <!-- Nos damos visibilidad mutuamente -->
                <span class="check">{% if q3406c == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
        </ul>
    </section>       

    <section id="sostenibilidad">
        <img class="icono" src="../../static/img/sostenibilidad_ecologica.png">
        <h2 class="titulo">{{TXT038}}</h2> <!-- Sostenibilidad ecológica -->
        <ul class="checklist">
            <li>{{TXT039}} <!-- Sistema de gestión ambiental -->
                <span class="check">{% if q4106a == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
            <li>{{TXT066}} <!-- Me formo sobre temas ambientales -->
                <span class="check">{% if q4106d == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
            <li>{{TXT041}} <!-- Divulgación ambiental a nivel externo -->
                <span class="check">{% if q4106c == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
            <li>{{TXT043}} <!-- Energía 100% renovable -->
                <span class="check">{% if ind62agrupado == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
        </ul>
    </section>

    <section id="trabajo">
        <img class="icono" src="../../static/img/trabajo_digno.png">
        <h2 class="titulo">{{TXT045}}</h2> <!-- Trabajo digno -->

        <ul class="checklist">
            <li>{{TXT067}} <!-- Horario laboral definido -->
                <span class="check">{% if q6813a == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
            <li>{{TXT068}} <!-- Se utiliza alguna herramienta para contabilizar las horas de trabajo -->
                <span class="check">{% if q6813b == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
            <li>{{TXT069}} <!-- Se diferencia el móvil personal del laboral -->
                <span class="check">{% if q6813c == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
            <li>{{TXT070}} <!-- Se utiliza alguna atención al emprendimiento u otro servicio similar -->
                <span class="check">{% if q6813d == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
        </ul>

    </section>
</div>

<div class="columna2">
    <section id="cooperacion">
        <h2 class="titulo">{{TXT030A}}</h2> <!-- Cooperación y -->
        <h2 class="titulo secundario"> {{TXT030B}}</h2> <!-- compromiso con el entorno -->

        <img class="icono" src="../../static/img/cooperacion.png">
        <img class="icono secundario" src="../../static/img/compromiso_entorno.png">

        <aside>
            <span class="cifra cifra1">{{ind254A}}%</span>
            <span class="label label1">{{TXT031}}</span> <!-- Compras dentro de la Economía Social -->
        </aside>


        <ul class="checklist">
            <li>{{TXT032}}</li> <!--  Intercooperación con mismo sector compartiendo: -->
            <li>{{TXT033}} <!-- Local -->
                <span class="check">{% if q5305a == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
            <li>{{TXT034}} <!-- Conocimiento -->
                <span class="check">{% if q5305b == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
            <li>{{TXT035}} <!-- Gestión -->
                <span class="check">{% if q5305c == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
            <li>{{TXT036}} <!-- Proyectos -->
                <span class="check">{% if q5305d == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
        </ul>

         <ul class="checklist secundario">
            <li>{{TXT037}} <!-- Opera con finanzas éticas -->
                <span class="check">{% if ind71 == "True" %}✔{% else %}✗{% endif %}</span>
            </li>
         </ul>

    </section>

    <section id="riqueza">
        <img class="icono" src="../../static/img/reparto_justo_riqueza.png">
        <h2 class="titulo">{{TXT050}}</h2> <!-- Reparto justo de la riqueza -->

        <h3 class="titulo t1 text-center"> {{TXT051}} </h3> <!-- Fuentes de ingresos -->

        <div id="ingresos"></div>

        <div class="reparto">
        <h3 class="titulo t2 text-center"> {{TXT055}} </h3> <!-- Reparto de beneficios -->

         <div class="columnas">
            <div class="text-center">
                <span class="cifra cifra3">{% if q1415e == "True" %}✔{% else %}✗{% endif %}</span>
                <span class="label label1">{{TXT071}}</span> <!-- Salario -->
                <span class="description"></span>
            </div>

            <div class="text-center">
                <span class="cifra cifra3">{% if q1415f == "True" %}✔{% else %}✗{% endif %}</span>
                <span class="label label1">{{TXT054}}</span> <!-- Otras -->
                <span class="description"></span>
            </div>

            <div class="text-center">
                <span class="cifra cifra3">{% if q1415a == "True" %}✔{% else %}✗{% endif %}</span>
                <span class="label label1">{{TXT058}}</span> <!-- A reservas -->
                <span class="description"></span>
            </div>
        </div>
        </div>

    </section>
</div>

<footer>
    <div class="leyenda">
        <div>✔={{TXT076}}</div>
        <div>✗={{TXT077}}</div>
    </div>
    <div class="seccion promueve">
        <span>{{TXT060|upper}}</span> <!-- PROMUEVE -->
        <div class="logos">
            {% if logo_reas %}<img src="{{logo_reas}}">{% endif %}
            {% if logo_mercado %}<img src="{{logo_mercado}}">{% endif %}
            <img src="../../static/img/reas.svg">
        </div>
    </div>
    <div class="seccion enlaces">
        {{web}}<br>
        {{email}}<br>
        reas.red | www.mercadosocial.net
    </div>
    <div class="seccion colabora">
        <span>{{TXT061|upper}}</span> <!-- COLABORA -->
        <div class="logos">
            <img src="../../static/img/ministerio_trabajo.jpg">
        </div>
    </div>
</footer>

<script type="text/javascript">
    Highcharts.chart('ingresos', {
        accessibility: {
            enabled: false
        },
        chart: {
            backgroundColor: 'transparent',
            type: 'pie'
        },
        title: {
            text: ''
        },
         navigation: {
            buttonOptions: {
                enabled: false
            }
        },
        plotOptions: {
            series: {
                enableMouseTracking: false,
                animation: false,
                borderRadius: 0,
                dataLabels: {
                    enabled: true,
                    crop: false,
                    overflow: 'none',
                    formatter: function(){ // your condition/check
                      if(this.y !== 0){
                        return '<div class="chart-text"><span class="cifra3">' + this.y + '%</span><br>' + this.point.name + '</div>';
                      }
                    }
                }
            },
            pie: {
                size: '100%',
                borderWidth:0,
                startAngle: 100,
                dataLabels: {

                    connectorShape: function(labelPosition, connectorPosition, options) {
                        // Let the built-in crookedLine function do the heavy lifting
                        const path = Highcharts.seriesTypes
                            .pie
                            .prototype
                            .pointClass
                            .prototype
                            .connectorShapes
                            .crookedLine
                            .call(this, labelPosition, connectorPosition, options);

                        const labelWidth = this.dataLabel.getBBox().width;
                        if (labelPosition.alignment === 'right') {
                            path[0][1] -= labelWidth;
                        } else {
                            path.push(['M', path[0][1], path[0][2]]);
                            path.push(['L', path[0][1] + labelWidth, path[0][2]]);
                        }

                        return path;
                    },
                    crop: false,
                    overflow: 'none',
                    useHTML: true
                }
            }
        },
        series: [
            {
                name: 'Percentage',
                colorByPoint: true,
                data: [
                    {
                        color:'#c42f43',
                        name: '{{TXT052}}', // Facturación
                        y: {{ ind6 if ind6 != "nan" else 0 }}
                    },
                    {
                        color:'#d56473',
                        name: '{{TXT053}}', // Subvenciones
                        y: {{ ind7 if ind7 != "nan" else 0 }}
                    },
                    {
                        color:'#ff9fac',
                        name: '{{TXT054}}', // Otras
                        y: {{ ind67agru if ind67agru != "nan" else 0 }}
                    }
                ]
            }
        ]
    });

    function redrawChart(){
        var chart = Highcharts.charts[0];

        var ingresos = document.getElementById('ingresos');
        var container = document.getElementById('riqueza');
        var w = container.offsetWidth;
        if (chart) {
          chart.setSize(w, w * (2/5), false);
        }
    }

    window.addEventListener('resize', redrawChart);
    redrawChart();

    var ingresosDiv = document.getElementById('ingresos');

    // Use html2canvas to rasterize the div
<!--    html2canvas(ingresosDiv, {backgroundColor:null}).then(function (canvas) {-->
<!--        // Convert the canvas to a data URL-->
<!--        var imgData = canvas.toDataURL('image/png');-->

<!--        // Create an image element and set the data URL as its source-->
<!--        var img = document.createElement('img');-->
<!--        img.src = imgData;-->
<!--        img.style.width = '100%';-->

<!--        // Replace the contents of the div with the image data-->
<!--        ingresosDiv.innerHTML = '';-->
<!--        ingresosDiv.appendChild(img);-->
<!--    });-->
</script>

</body>
</html>

